# Global settings
global:
  namespace: app-demo
  registry: host.docker.internal:8082/cicd-demo

# Backend service
backend:
  enabled: true
  name: cicd-demo-backend
  replicaCount: 2

  image:
    repository: host.docker.internal:8082/cicd-demo/app
    tag: latest
    pullPolicy: Never

  service:
    type: ClusterIP
    port: 8001
    targetPort: 8001
    containerPort: 8001

  env:
    - name: DB_HOST
      value: postgres
    - name: DB_NAME
      value: cicd_demo
    - name: DB_USER
      valueFrom:
        configMapKeyRef:
          name: postgres-config
          key: POSTGRES_USER
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: POSTGRES_PASSWORD

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    readOnlyRootFilesystem: true

  volumeMounts:
    - name: tmp
      mountPath: /tmp
    - name: app-logs
      mountPath: /app/logs

  volumes:
    - name: tmp
      emptyDir: {}
    - name: app-logs
      emptyDir: {}

  livenessProbe:
    httpGet:
      path: /actuator/health/liveness
      port: 8001
    initialDelaySeconds: 60
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /actuator/health/readiness
      port: 8001
    initialDelaySeconds: 30
    periodSeconds: 5

# Frontend service
frontend:
  enabled: true
  name: cicd-demo-frontend
  replicaCount: 2

  image:
    repository: host.docker.internal:8082/cicd-demo/frontend
    tag: latest
    pullPolicy: Never

  service:
    type: NodePort
    port: 80
    targetPort: 80
    containerPort: 80
    nodePort: 30080

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "250m"

  securityContext:
    runAsNonRoot: true
    runAsUser: 101
    fsGroup: 101
    readOnlyRootFilesystem: true

  volumeMounts:
    - name: nginx-cache
      mountPath: /var/cache/nginx
    - name: nginx-run
      mountPath: /var/run
    - name: tmp
      mountPath: /tmp

  volumes:
    - name: nginx-cache
      emptyDir: {}
    - name: nginx-run
      emptyDir: {}
    - name: tmp
      emptyDir: {}

  livenessProbe:
    httpGet:
      path: /health
      port: 80
    initialDelaySeconds: 10
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /health
      port: 80
    initialDelaySeconds: 5
    periodSeconds: 5

# Legacy compatibility - will be deprecated
replicaCount: 2

image:
  repository: host.docker.internal:8082/cicd-demo/app
  pullPolicy: Never
  tag: "latest"

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

service:
  type: NodePort
  port: 80
  targetPort: 8001
  containerPort: 8001

livenessProbe:
  httpGet:
    path: /health
    port: 8001
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: 8001
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts: []
  tls: []

httpRoute:
  enabled: false
  annotations: {}
  parentRefs: []
  hostnames: []
  rules: []

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi